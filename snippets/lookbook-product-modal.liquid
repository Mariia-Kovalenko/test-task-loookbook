<div class="modal" id="lookbookProductModal" style="display:none;">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="product-list" style="overflow-y: auto; max-height: 80vh;">
            {% for product in section.settings.products %}
            <div class="product-item">
                <img src="{{ product.image | img_url: 'small' }}" alt="{{ product.title }}" class="product-image" />
                <div class="product-details">
                    <h3>{{ product.title }} - {{ product.price | money }}</h3>
                    <div class="variant-picker">
                        <select name="variant-select" class="variant-select">
                            {% for variant in product.variants %}
                            <option value="{{ variant.id }}">{{ variant.title }}</option>
                            {% endfor %}
                        </select>
                        <button class="add-to-cart-btn" data-product-id="{{ product.id }}">Add to bag</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
}
.modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 5px;
    width: 80%;
    max-width: 1000px;
}
.product-list {
    display: flex;
    flex-direction: column;
}
.product-item {
    display: flex;
    margin-bottom: 15px;
    align-items: center;
}
.product-image {
    max-width: 100px;
    margin-right: 20px;
}
.variant-picker {
    display: flex;
    align-items: center;
}
.variant-select {
    margin-right: 10px;
}
</style>

<script>
document.querySelectorAll('.shop-the-look-btn').forEach(function(button) {
    button.addEventListener('click', function() {
        document.getElementById('lookbookProductModal').style.display = 'flex';
    });
});
document.querySelectorAll('.close').forEach(function(span) {
    span.addEventListener('click', function() {
        document.getElementById('lookbookProductModal').style.display = 'none';
    })
});

window.onclick = function(event) {
    if (event.target == document.getElementById('lookbookProductModal')) {
        document.getElementById('lookbookProductModal').style.display = 'none';
    }
}

document.querySelectorAll('.add-to-cart-btn').forEach(function(button) {
    button.addEventListener('click', function(event) {
        event.preventDefault();
        const variantId = this.previousElementSibling.value;
        const productId = this.dataset.productId;
        
        fetch('/cart/add.js', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                items: [
                    {
                        id: variantId,
                        quantity: 1
                    }
                ]
            })
        })
        .then(response => response.json())
        .then(data => {
            // Handle successful add to cart
            console.log('Product added', data);
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    });
});
</script>
